# üîÑ **Recursive Functions in SQL**

In SQL, recursion is usually implemented using **Recursive Common Table Expressions (CTEs)**.

üëâ **A recursive CTE has 3 parts**:

1. **Anchor member (base case)** ‚Üí The starting row(s).
2. **Recursive member** ‚Üí A query that refers to the CTE itself.
3. **Termination** ‚Üí Recursion stops when no new rows are produced.

---

# üèóÔ∏è Example 1: Employee Hierarchy (Org Chart)

### Table: `employees`

| emp\_id | name  | manager\_id |
| ------- | ----- | ----------- |
| 1       | Alice | NULL        |
| 2       | Bob   | 1           |
| 3       | Cathy | 2           |
| 4       | David | 2           |
| 5       | Emma  | 3           |

üëâ Query: Get all employees under **Alice** (CEO).

```sql
WITH RECURSIVE employee_hierarchy AS (
    -- Base case: CEO (no manager)
    SELECT emp_id, name, manager_id
    FROM employees
    WHERE manager_id IS NULL
    
    UNION ALL
    
    -- Recursive case: find employees managed by previous level
    SELECT e.emp_id, e.name, e.manager_id
    FROM employees e
    INNER JOIN employee_hierarchy eh ON e.manager_id = eh.emp_id
)
SELECT * FROM employee_hierarchy;
```

**Output:**

```
1 | Alice | NULL
2 | Bob   | 1
3 | Cathy | 2
4 | David | 2
5 | Emma  | 3
```

---

# üèóÔ∏è Example 2: Numbers from 1 to 10 (Recursive CTE as Loop)

```sql
WITH RECURSIVE numbers AS (
    SELECT 1 AS n   -- Base case
    UNION ALL
    SELECT n + 1    -- Recursive step
    FROM numbers
    WHERE n < 10    -- Termination
)
SELECT * FROM numbers;
```

**Output:**

```
1
2
3
...
10
```

---

# üèóÔ∏è Example 3: Directory Tree (Folders & Subfolders)

### Table: `folders`

| id | folder\_name | parent\_id |
| -- | ------------ | ---------- |
| 1  | root         | NULL       |
| 2  | docs         | 1          |
| 3  | images       | 1          |
| 4  | reports      | 2          |
| 5  | 2024         | 4          |

üëâ Query: Get full folder hierarchy.

```sql
WITH RECURSIVE folder_hierarchy AS (
    -- Base case: root
    SELECT id, folder_name, parent_id, folder_name AS path
    FROM folders
    WHERE parent_id IS NULL
    
    UNION ALL
    
    -- Recursive case: append child to path
    SELECT f.id, f.folder_name, f.parent_id, fh.path || '/' || f.folder_name
    FROM folders f
    INNER JOIN folder_hierarchy fh ON f.parent_id = fh.id
)
SELECT * FROM folder_hierarchy;
```

**Output:**

```
1 | root    | NULL | root
2 | docs    | 1    | root/docs
3 | images  | 1    | root/images
4 | reports | 2    | root/docs/reports
5 | 2024    | 4    | root/docs/reports/2024
```

---

# üñºÔ∏è Analogy

SQL recursion is like **walking down a family tree üë®‚Äçüë©‚Äçüëß**:

* Base case = grandparents (root).
* Recursive case = children ‚Üí grandchildren ‚Üí great-grandchildren.
* Stops when there are no more descendants.

---

# ‚úÖ Summary

* SQL recursion = **Recursive CTEs (`WITH RECURSIVE`)**.
* Used for **hierarchies, trees, sequences, pathfinding**.
* Components: **Anchor query (base case)** + **Recursive query (calls itself)**.
* Stops when recursion produces no new rows.
