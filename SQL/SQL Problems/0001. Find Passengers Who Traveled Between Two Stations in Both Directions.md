## Given a table with passenger travel records containing `PassengerID`, `FromStation`, and `ToStation`, write an SQL query to find passengers who have traveled **both ways** — that is, from **Station A to Station B** and also from **Station B to Station A**.

| Passenger ID | From Station | To Station |
| ------------ | ------------ | ---------- |
| 001          | Station A    | Station B  |
| 001          | Station B    | Station A  |
| 002          | Station B    | Station A  |

---

### SQL Solution:

Assuming your table is named `PassengerTrips`, the query can be written using a self-join or aggregation approach.

#### Using Self-Join:

```sql
SELECT DISTINCT p1.PassengerID
FROM PassengerTrips p1
JOIN PassengerTrips p2
  ON p1.PassengerID = p2.PassengerID
WHERE p1.FromStation = 'Station A' 
  AND p1.ToStation = 'Station B'
  AND p2.FromStation = 'Station B' 
  AND p2.ToStation = 'Station A';
```

## **Step-by-Step Explanation**

### 1️⃣ **`FROM PassengerTrips p1`**

We start by selecting data from the table `PassengerTrips` and give it an alias `p1` (just a short name so we can refer to it easily).

---

### 2️⃣ **`JOIN PassengerTrips p2 ON p1.PassengerID = p2.PassengerID`**

Here we join the **same table** to itself (self-join).

* `p1` = one trip record
* `p2` = another trip record for the same passenger
* The join condition `p1.PassengerID = p2.PassengerID` ensures we are matching trips belonging to the **same passenger**.

---

### 3️⃣ **`WHERE` conditions**

We now filter **both sides of the join**:

* **`p1.FromStation = 'Station A' AND p1.ToStation = 'Station B'`**
  → This means trip `p1` is a journey from **A to B**.

* **`p2.FromStation = 'Station B' AND p2.ToStation = 'Station A'`**
  → This means trip `p2` is a journey from **B to A**.

Since we’re joining on the same passenger, these two conditions together mean:

> The same passenger must have a trip **A → B** and also **B → A**.

---

### 4️⃣ **`SELECT DISTINCT p1.PassengerID`**

We only return the unique passenger IDs who satisfy both travel directions.

---

## **How it works with the example data**

| Passenger ID | From Station | To Station |
| ------------ | ------------ | ---------- |
| 001          | Station A    | Station B  |
| 001          | Station B    | Station A  |
| 002          | Station B    | Station A  |

* Passenger `001` → Has both `A → B` (p1) and `B → A` (p2) → ✅ included.
* Passenger `002` → Only has `B → A`, missing `A → B` → ❌ excluded.

**Output:**

| PassengerID |
| ----------- |
| 001         |

---

#### Using Aggregation and HAVING:

```sql
SELECT PassengerID
FROM PassengerTrips
WHERE (FromStation = 'Station A' AND ToStation = 'Station B')
   OR (FromStation = 'Station B' AND ToStation = 'Station A')
GROUP BY PassengerID
HAVING COUNT(DISTINCT CONCAT(FromStation, '->', ToStation)) = 2;
```

**Explanation:**

* The `WHERE` filters trips for either direction.
* The `HAVING` ensures the passenger has records for **both** directions by counting distinct routes.

---

Would you like me to explain the queries step-by-step?
