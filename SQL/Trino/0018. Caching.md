# 📌 What is Caching in Trino?

* 🚀 **Caching** = Storing query results or frequently accessed data closer to the compute layer to reduce repeated reads from slow/remote storage (e.g., S3, HDFS, Azure Blob).
* 🎯 Purpose: **Faster queries** + **lower storage I/O cost**.
* Trino supports caching mainly through:

  1. **Result Caching** (reuses query results).
  2. **File/Metadata Caching** (caches remote storage metadata & small files).
  3. **Materialized Views** (precomputed cache in table form).

---

# ⚙️ Types of Caching in Trino

### 1. 🔁 **Query Result Caching**

* If the **same query is executed multiple times**, Trino can return cached results instead of recomputing.
* Often configured via the **`query-results-cache` plugin**.

👉 Example:

```sql
-- First run (query result stored in cache)
SELECT customer_id, SUM(amount) 
FROM orders 
WHERE order_date >= DATE '2025-09-01'
GROUP BY customer_id;

-- Second run (same query, results served from cache 🚀)
SELECT customer_id, SUM(amount) 
FROM orders 
WHERE order_date >= DATE '2025-09-01'
GROUP BY customer_id;
```

⚡ The second query is instant because results are fetched from cache.

---

### 2. 📂 **File/Metadata Caching (Local Cache)**

* Used when Trino queries **remote object storage** (e.g., S3, GCS, ADLS).
* Trino can cache **small files and metadata** locally on worker nodes.
* Configured via **`hive.cache.enabled=true`** (for Hive/iceberg connectors).

👉 Example:

```properties
hive.cache.enabled=true
hive.cache.location=/mnt/trino-cache
hive.cache.disk-usage-percentage=80
```

Now when you query:

```sql
SELECT * 
FROM hive.retail.sales 
WHERE region = 'APAC';
```

* 📥 Metadata & files are cached locally → faster subsequent queries.

---

### 3. 💾 **Materialized Views (MV as Cache)**

* Precomputed tables act like a **manual cache** for expensive queries.

👉 Example:

```sql
CREATE MATERIALIZED VIEW retail.mv_daily_sales
AS
SELECT sale_date, region, SUM(amount) AS total_sales
FROM retail.sales
GROUP BY sale_date, region;
```

Now when you run:

```sql
SELECT * 
FROM retail.mv_daily_sales
WHERE sale_date = DATE '2025-09-22';
```

👉 Trino fetches from the MV (cache) instead of scanning the entire `sales` table.

---

# 🖼️ Visual Summary

| Cache Type             | Where It Helps              | Example Use Case                  |
| ---------------------- | --------------------------- | --------------------------------- |
| 🔁 Result Cache        | Query repeats               | BI dashboards with same queries   |
| 📂 File/Metadata Cache | Remote storage access       | Hive/Parquet/ORC on S3/HDFS       |
| 💾 Materialized View   | Heavy repeated aggregations | Daily sales, fact-dimension joins |

---

# 💡 Pro Tip

* Use **result caching** for repeated BI queries.
* Use **file/metadata caching** when querying cloud storage (S3/ADLS).
* Use **materialized views** when query patterns are predictable & expensive.
