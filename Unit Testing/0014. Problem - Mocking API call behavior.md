**main.py**

```python
import requests

def get_weather(city):
    """Fetches weather data for the given city from a weather API."""
    response = requests.get(f"https://api.weather.com/v1/{city}")
    if response.status_code == 200:
        return response.json()
    else:
        raise ValueError("Could not fetch weather data")
```

---

**test\_main.py**

```python
import pytest
from main import get_weather

def test_get_weather(mocker):
    # Mock requests.get
    mock_get = mocker.patch("main.requests.get")

    # Set return values for the mock object
    mock_get.return_value.status_code = 200
    mock_get.return_value.json.return_value = {"temperature": 25, "condition": "Sunny"}

    # Call the function
    result = get_weather("Dubai")

    # Assertions
    assert result == {"temperature": 25, "condition": "Sunny"}
    mock_get.assert_called_once_with("https://api.weather.com/v1/Dubai")
```

---

## **How it works**

### **1. The function being tested (`get_weather`)**

* Takes a `city` name.
* Calls the weather API endpoint:

  ```python
  requests.get(f"https://api.weather.com/v1/{city}")
  ```
* If the HTTP status is `200 OK`, returns the JSON response.
* Otherwise, raises a `ValueError`.

---

### **2. The test function (`test_get_weather`)**

* Uses **pytest’s `mocker` fixture** (comes from `pytest-mock`) to **replace** `requests.get` with a **mock object**.
* **`mock_get.return_value.status_code = 200`** → Simulates a successful HTTP response.
* **`mock_get.return_value.json.return_value = {...}`** → Simulates the JSON data returned by the API.
* Calls the real `get_weather("Dubai")` function.
* Asserts that:

  * The returned data matches the mocked data.
  * The mocked `requests.get` was called exactly once with the correct URL.

---

### **Why mock here?**

* You **don’t** want to make a real HTTP request every time you run tests (slower, unreliable, needs internet).
* Mocking lets you:

  * Control the API’s behavior (success/failure).
  * Test edge cases without depending on the real API.

---

✅ **Run the tests**

```bash
pip install pytest pytest-mock
pytest -v
```

Expected output:

```
test_main.py::test_get_weather PASSED
```
