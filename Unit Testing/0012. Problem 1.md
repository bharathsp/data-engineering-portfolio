# Main Code

```python
# db.py
class Database:
    """Simulates a basic user database."""

    def __init__(self):
        self.data = {}  # Stores user_id â†’ name pairs

    def add_user(self, user_id, name):
        if user_id in self.data:
            raise ValueError("User already exists")
        self.data[user_id] = name

    def get_user(self, user_id):
        return self.data.get(user_id, None)

    def delete_user(self, user_id):
        if user_id in self.data:
            del self.data[user_id]
```

---

# Test Code

```python
# test_db.py
import pytest
from db import Database

@pytest.fixture
def db():
    """Provides a fresh instance of the Database class and cleans up after the test."""
    database = Database()
    yield database
    database.data.clear()  # Cleanup step (important for real databases)

def test_add_user(db):
    db.add_user(1, "Alice")
    assert db.get_user(1) == "Alice"

def test_add_duplicate_user(db):
    db.add_user(1, "Alice")
    with pytest.raises(ValueError, match="User already exists"):
        db.add_user(1, "Bob")

def test_delete_user(db):
    db.add_user(2, "Bob")
    db.delete_user(2)
    assert db.get_user(2) is None
```

---

### **How to run**

1. Save `db.py` and `test_db.py` in the same folder.
2. Install pytest if you havenâ€™t:

   ```bash
   pip install pytest
   ```
3. Run tests:

   ```bash
   pytest -v
   ```

---

ðŸ’¡ **Output you should see:**

```
==================== test session starts ====================
collected 3 items

test_db.py::test_add_user PASSED                     [ 33%]
test_db.py::test_add_duplicate_user PASSED           [ 66%]
test_db.py::test_delete_user PASSED                  [100%]

===================== 3 passed in 0.05s =====================
```

---

## **What this code does**

This is a **pytest** test suite for a small `Database` class that simulates storing users in memory (a Python dictionary).

---

### **1. The `Database` class**

```python
class Database:
    """Simulates a basic user database."""

    def __init__(self):
        self.data = {}  # This stores user_id â†’ name pairs

    def add_user(self, user_id, name):
        if user_id in self.data:
            raise ValueError("User already exists")
        self.data[user_id] = name

    def get_user(self, user_id):
        return self.data.get(user_id, None)

    def delete_user(self, user_id):
        if user_id in self.data:
            del self.data[user_id]
```

#### **How it works:**

* **`__init__`** â†’ Creates an empty dictionary to store users.
* **`add_user`** â†’ Adds a new user; raises an error if the user ID already exists.
* **`get_user`** â†’ Retrieves a userâ€™s name; returns `None` if not found.
* **`delete_user`** â†’ Deletes a user if they exist.

---

### **2. The pytest fixture**

```python
import pytest
from db import Database

@pytest.fixture
def db():
    """Provides a fresh instance of the Database class and cleans up after the test."""
    database = Database()
    yield database
    database.data.clear()  # Cleanup (important for real databases, less so for in-memory)
```

#### **Why use a fixture?**

* **Reusability** â†’ Instead of creating a `Database()` in every test, we make it once in the fixture.
* **Fresh state** â†’ Each test gets a clean, empty database.
* **Cleanup step** â†’ After the test finishes, `.clear()` removes all data.

---

### **3. The tests**

#### **Test: Add a user**

```python
def test_add_user(db):
    db.add_user(1, "Alice")
    assert db.get_user(1) == "Alice"
```

Checks that adding a user stores them correctly.

---

#### **Test: Adding a duplicate user**

```python
def test_add_duplicate_user(db):
    db.add_user(1, "Alice")
    with pytest.raises(ValueError, match="User already exists"):
        db.add_user(1, "Bob")
```

* First, adds a user with ID `1`.
* Then tries adding the same ID again â€” should raise a `ValueError`.
* `pytest.raises` confirms that the exception is raised **and** the error message matches `"User already exists"`.

---

#### **Test: Delete a user**

```python
def test_delete_user(db):
    db.add_user(2, "Bob")
    db.delete_user(2)
    assert db.get_user(2) is None
```

* Adds a user with ID `2`.
* Deletes them.
* Confirms that `get_user` returns `None`.

---

### **4. Key pytest concepts shown here**

* **`@pytest.fixture`** â†’ Reusable setup for tests.
* **`pytest.raises`** â†’ Tests that an error is thrown.
* **Assertions** â†’ Verify results.

---

âœ… **In short:**
This code defines a simple in-memory `Database` class and uses pytest to verify that:

1. You can add and retrieve users.
2. Adding the same user twice raises an error.
3. You can delete users successfully.

---
