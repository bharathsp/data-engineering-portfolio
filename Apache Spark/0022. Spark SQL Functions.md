## **Spark SQL functions**

---

### üßæ **1. `createOrReplaceTempView("view_name")`**

**Definition**:
Registers a DataFrame as a temporary SQL table (view), which allows SQL queries to be run using `spark.sql()`.

**Syntax**:

```python
df.createOrReplaceTempView("employee_view")
```

> ‚ö†Ô∏è The view exists only during the lifetime of the Spark session.

**Example Input DataFrame**:

```python
+-------+--------+------+
| Name  | Dept   | Age  |
+-------+--------+------+
| Alice | HR     | 30   |
| Bob   | IT     | 25   |
+-------+--------+------+
```

**Usage**:

```python
df.createOrReplaceTempView("employee_view")
result = spark.sql("SELECT * FROM employee_view WHERE Age > 26")
result.show()
```

**Output**:

```text
+-------+-----+---+
| Name  |Dept |Age|
+-------+-----+---+
| Alice | HR  |30 |
+-------+-----+---+
```

---

### üßæ **2. `spark.sql("SQL_QUERY")`**

**Definition**:
Executes SQL queries on registered temporary views or Hive tables.

**Syntax**:

```python
result = spark.sql("SELECT Dept, COUNT(*) as count FROM employee_view GROUP BY Dept")
```

**Example Input View (`employee_view`)**:

```text
+-------+--------+------+
| Name  | Dept   | Age  |
+-------+--------+------+
| Alice | HR     | 30   |
| Bob   | IT     | 25   |
| John  | HR     | 28   |
+-------+--------+------+
```

**Query**:

```python
spark.sql("SELECT Dept, COUNT(*) as count FROM employee_view GROUP BY Dept").show()
```

**Output**:

```text
+-------+-----+
| Dept  |count|
+-------+-----+
| HR    |  2  |
| IT    |  1  |
+-------+-----+
```

---

### üßæ **3. `saveAsTable("table_name")`**

**Definition**:
Saves a DataFrame as a persistent Hive or Spark table, which can be queried using SQL even after the session ends (if Hive support is enabled).

**Syntax**:

```python
df.write.mode("overwrite").saveAsTable("employee_table")
```

> ‚ö†Ô∏è Requires Hive support to be enabled (`enableHiveSupport()` in `SparkSession`)

**Example Input DataFrame**:

```text
+-------+--------+------+
| Name  | Dept   | Age  |
+-------+--------+------+
| Alice | HR     | 30   |
| Bob   | IT     | 25   |
+-------+--------+------+
```

**Usage**:

```python
df.write.mode("overwrite").saveAsTable("employee_table")
```

**Querying it later**:

```python
spark.sql("SELECT * FROM employee_table").show()
```

**Output**:

```text
+-------+--------+-----+
| Name  | Dept   | Age |
+-------+--------+-----+
| Alice | HR     | 30  |
| Bob   | IT     | 25  |
+-------+--------+-----+
```

---
