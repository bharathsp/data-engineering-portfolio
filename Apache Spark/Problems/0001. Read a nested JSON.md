## How to **read a nested JSON** in **PySpark**

To **read a nested JSON** in **PySpark**, you use the `spark.read.json()` method to load the file into a **DataFrame**, then use **dot notation** or **`explode`/`withColumn`** functions to access or flatten nested fields.

---

### ‚úÖ Step-by-Step Guide

#### üìÅ Sample Nested JSON (`data.json`)

```json
[
  {
    "id": 1,
    "name": "Alice",
    "address": {
      "city": "Bangalore",
      "zip": "560037"
    },
    "phones": ["1234567890", "9876543210"]
  },
  {
    "id": 2,
    "name": "Bob",
    "address": {
      "city": "Mumbai",
      "zip": "400001"
    },
    "phones": ["9999999999"]
  }
]
```

---

### 1Ô∏è‚É£ Read the JSON

```python
from pyspark.sql import SparkSession

spark = SparkSession.builder.appName("NestedJSON").getOrCreate()

# Read the JSON file
df = spark.read.json("data.json")

df.printSchema()
df.show(truncate=False)
```

---

### 2Ô∏è‚É£ Access Nested Fields Using Dot Notation

```python
df.select(
    "id",
    "name",
    "address.city",
    "address.zip"
).show()
```

---

### 3Ô∏è‚É£ Explode Arrays (like `phones`)

```python
from pyspark.sql.functions import explode

df.select(
    "id",
    "name",
    explode("phones").alias("phone")
).show()
```

---

### 4Ô∏è‚É£ Flatten Deeply Nested JSON (Using `withColumn` and Structs)

If a field is deeply nested:

```python
df = df.withColumn("city", df["address"]["city"]) \
       .withColumn("zip", df["address"]["zip"])

df.select("id", "name", "city", "zip").show()
```

---

### üß† Optional: Automatically Infer and Flatten Schema Using `schema_of_json` (for dynamic data)

```python
from pyspark.sql.functions import schema_of_json, from_json, lit

sample_json = '''{"id":1,"name":"Alice","address":{"city":"Bangalore","zip":"560037"}}'''

schema = spark.range(1).select(schema_of_json(lit(sample_json))).first()[0]

df = spark.read.schema(schema).json("data.json")
```

---

### üìå Summary

| Operation             | Method                             |
| --------------------- | ---------------------------------- |
| Load JSON             | `spark.read.json()`                |
| Access nested field   | Dot notation or `withColumn()`     |
| Explode array         | `explode()`                        |
| Flatten deeply nested | Chain `withColumn()` or `select()` |
