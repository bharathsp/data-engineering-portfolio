You are given a PySpark DataFrame containing employee details with the following columns: `employee_name`, `department`, and `salary`.

#### Sample Data:

| employee\_name | department | salary |
| -------------- | ---------- | ------ |
| James          | Sales      | 3000   |
| Michael        | Sales      | 4600   |
| Robert         | Sales      | 4600   |
| Maria          | Finance    | 3000   |
| Scott          | Finance    | 3300   |
| Jen            | Finance    | 3900   |
| Jeff           | Marketing  | 3000   |
| Kumar          | Marketing  | 2000   |
| Saif           | Sales      | 4100   |
| Scott          | Finance    | 3300   |

---

### **Task:**

Write PySpark code to retrieve the **employee(s) with the 3rd highest salary** in **each department**.

---

To find the **3rd highest salary in each department** using **PySpark**, you can use the `dense_rank()` or `row_number()` window function.

---

### ✅ **PySpark Code: Find 3rd Highest Salary per Department**

```python
from pyspark.sql import SparkSession
from pyspark.sql.functions import dense_rank
from pyspark.sql.window import Window

# Sample data
data = [
    ("James", "Sales", 3000),
    ("Michael", "Sales", 4600),
    ("Robert", "Sales", 4600),
    ("Maria", "Finance", 3000),
    ("Scott", "Finance", 3300),
    ("Jen", "Finance", 3900),
    ("Jeff", "Marketing", 3000),
    ("Kumar", "Marketing", 2000),
    ("Saif", "Sales", 4100),
    ("Scott", "Finance", 3300),
]

columns = ["employee_name", "department", "salary"]
df = spark.createDataFrame(data, columns)

# Define window spec partitioned by department and ordered by salary descending
window_spec = Window.partitionBy("department").orderBy(df["salary"].desc())

# Apply dense_rank to get the rank of salaries
ranked_df = df.withColumn("rank", dense_rank().over(window_spec))

# Filter where rank = 3
third_highest_salary_df = ranked_df.filter(ranked_df["rank"] == 3)

third_highest_salary_df.select("department", "employee_name", "salary").show()
```

---

### ✅ **Output:**

For the given data, the output will be:

```
+----------+-------------+------+
|department|employee_name|salary|
+----------+-------------+------+
|   Finance|        Maria|  3000|
|     Sales|        James|  3000|
+----------+-------------+------+
```

> Note:

* If you want to break ties strictly (i.e., avoid duplicate ranks for the same salary), you can use `row_number()` instead of `dense_rank()`.
* `dense_rank()` is preferred here since two people can have the same salary.
