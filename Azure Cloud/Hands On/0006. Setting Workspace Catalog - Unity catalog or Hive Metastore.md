👉 **Unity Catalog vs. Hive Metastore (workspace catalog)**

Let’s go step-by-step to understand:
1️⃣ What they are
2️⃣ How to set up **Unity Catalog** or **Hive Metastore**
3️⃣ When to use which
4️⃣ Advantages and disadvantages of each

---

# 🧩 1️⃣ What is a Catalog in Databricks?

A **catalog** is the **top-level namespace** in Databricks that organizes your data objects (databases, tables, views, functions).

**Hierarchy:**

```
catalog → schema (database) → table / view
```

In Azure Databricks, you can use **two types of catalogs**:

| Catalog Type                   | Description                                                                    |
| ------------------------------ | ------------------------------------------------------------------------------ |
| 🐝 **Hive Metastore (legacy)** | The default workspace-level catalog (each workspace has its own metastore)     |
| 🧠 **Unity Catalog (modern)**  | A centralized, secure, multi-workspace governance layer for data and AI assets |

---

# ⚙️ 2️⃣ How to Set a Workspace Catalog

---

## 🧠 A. Setup **Unity Catalog**

### 🔸 **Prerequisites**

1. You must be on the **Premium or Enterprise tier** of Databricks.
2. You need **Azure Databricks account-level access** (not just workspace admin).
3. You must have **an external storage account (ADLS Gen2)** to host data and metastore.
4. You must have **Azure Active Directory (AAD) and Managed Identity access** set up.

---

### 🔹 **Step 1: Go to Databricks Account Console**

* Go to [https://accounts.azuredatabricks.net](https://accounts.azuredatabricks.net)
* Sign in with your **account admin** credentials (not workspace-only).

---

### 🔹 **Step 2: Create a Unity Metastore**

1. Navigate to **Data → Metastores → Create Metastore**

2. Fill details:

   * **Name:** `main-metastore`
   * **Region:** Same as your workspace (e.g., `East US`)
   * **Default Data Root:** Azure Data Lake Gen2 container path (e.g., `abfss://data@storageacc.dfs.core.windows.net/unitycatalog`)
   * Assign a **Managed Identity** for access.

3. Click **Create**

---

### 🔹 **Step 3: Assign the Metastore to a Workspace**

1. In **Account Console → Workspaces**
2. Select the target workspace
3. Click **Assign Metastore → Choose “main-metastore”**

Now, that workspace is governed by **Unity Catalog**.

---

### 🔹 **Step 4: Configure Permissions**

* Go to **Databricks Workspace → Data → Catalog Explorer**
* You’ll now see your **Unity Catalog** listed.
* Grant permissions (CREATE, SELECT, USE SCHEMA, USE CATALOG) to users, groups, or service principals.

---

### 🔹 **Step 5: Create Catalogs and Schemas**

Example (SQL or Notebook):

```sql
CREATE CATALOG sales_catalog;
USE CATALOG sales_catalog;

CREATE SCHEMA retail_data;
CREATE TABLE retail_data.transactions (
  id INT,
  product STRING,
  amount DOUBLE
);
```

✅ You can now access data as:

```
sales_catalog.retail_data.transactions
```

---

## 🐝 B. Setup **Hive Metastore (Default)**

If you haven’t configured Unity Catalog, Databricks automatically uses **Hive Metastore**.

### 🔹 **Step 1: Verify**

Run this in a notebook:

```sql
SHOW CATALOGS;
```

Output:

```
hive_metastore
```

This is your default workspace metastore.

---

### 🔹 **Step 2: Create Database & Tables**

```sql
CREATE DATABASE retail_data;
USE retail_data;

CREATE TABLE sales (
  id INT,
  item STRING,
  price DOUBLE
);
```

Data is stored in **DBFS** (Databricks File System) under:

```
/user/hive/warehouse/
```

---

### 🔹 **Step 3: Optional — External Hive Metastore**

You can connect to an **external Hive Metastore** (e.g., hosted in MySQL or PostgreSQL) if you need persistence across workspaces.
This requires custom cluster configuration using Spark configs:

```bash
spark.hadoop.javax.jdo.option.ConnectionURL jdbc:mysql://<metastore-db>:3306/metastore
spark.hadoop.javax.jdo.option.ConnectionUserName hive
spark.hadoop.javax.jdo.option.ConnectionPassword <password>
```

---

# ⚖️ 3️⃣ Unity Catalog vs. Hive Metastore — Comparison

| Feature           | 🧠 Unity Catalog                                            | 🐝 Hive Metastore                  |
| ----------------- | ----------------------------------------------------------- | ---------------------------------- |
| **Scope**         | Account-level (shared across workspaces)                    | Workspace-level only               |
| **Security**      | Fine-grained (row, column-level)                            | Basic (database/table-level)       |
| **Governance**    | Centralized (cross-workspace)                               | Decentralized                      |
| **Data Lineage**  | Supported (tracks dependencies)                             | Not available                      |
| **Integration**   | Works with Delta Sharing, MLflow, and data governance tools | Limited                            |
| **Storage**       | External ADLS Gen2                                          | DBFS (internal)                    |
| **Performance**   | Slightly slower first access (governance checks)            | Fast for local workspace           |
| **Ease of Setup** | Requires account admin setup                                | Automatically available            |
| **Best for**      | Enterprises with multiple workspaces or compliance needs    | Small teams or dev/test workspaces |

---

# 💡 4️⃣ When to Use Which

| Use Case                                               | Recommended Catalog |
| ------------------------------------------------------ | ------------------- |
| 🧑‍💻 Single workspace, development/testing            | Hive Metastore      |
| 🏢 Multi-workspace environment (e.g., dev, test, prod) | Unity Catalog       |
| 🔐 Data governance, auditing, lineage needed           | Unity Catalog       |
| ⚡ Simplicity, fast setup                               | Hive Metastore      |
| 🌍 External data sharing or Delta Sharing              | Unity Catalog       |

---

# 🚀 5️⃣ Switching from Hive Metastore → Unity Catalog

If you migrate to Unity Catalog later:

1. Export Hive Metastore metadata (Databases, Tables).
2. Create equivalent Catalogs & Schemas in Unity Catalog.
3. Re-point your Delta tables (use `ALTER TABLE ... SET LOCATION`).
4. Grant proper access using Unity permissions.

---

# 🧭 6️⃣ Summary

| Step                 | Hive Metastore         | Unity Catalog                |
| -------------------- | ---------------------- | ---------------------------- |
| Default availability | ✅ Enabled by default   | ❌ Must be created manually   |
| Data root            | `/user/hive/warehouse` | ADLS Gen2 container          |
| Central governance   | ❌ No                   | ✅ Yes                        |
| Permissions model    | Workspace only         | Account-level (fine-grained) |
| When to use          | Small/simple setups    | Enterprise-grade governance  |

---

Would you like me to include a **visual diagram** (with icons) showing
→ Unity Catalog + Workspaces + Metastore + Storage relationships
and
→ how Hive Metastore differs in isolation?
