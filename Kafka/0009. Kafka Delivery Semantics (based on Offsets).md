# 📌 Kafka Delivery Semantics (based on Offsets)

Kafka’s **offset management** directly impacts how messages are delivered and whether they can be reprocessed or lost.

There are **3 main delivery semantics**:

---

## 1️⃣ **At-Most-Once (⚡ Fast but Risky)**

* Offsets are **committed before processing** a message.
* If the consumer crashes after committing but before finishing processing → that message is **lost**.

👉 **Guarantee:** Message is delivered **0 or 1 time** (no duplicates, but possible loss).

🔹 Example:

* Consumer commits offset=5 before actually processing message at offset=4.
* If crash happens → message 4 is skipped. ❌

---

## 2️⃣ **At-Least-Once (✅ Reliable, but may duplicate)**

* Offsets are **committed after processing** a message.
* If the consumer crashes before committing → it will reprocess the same message after restart.
* So, messages are **never lost**, but may be **processed more than once**.

👉 **Guarantee:** Message is delivered **1 or more times** (safe but may duplicate).

🔹 Example:

* Consumer processes message at offset=4, but crashes before committing.
* On restart → it will reprocess message 4 again → duplicate ✅

---

## 3️⃣ **Exactly-Once (🏆 Ideal but Complex)**

* Ensures each message is processed **exactly once** — no loss, no duplication.
* Achieved by combining **idempotent producers** + **transactions** in Kafka + careful offset commits.
* Kafka Streams and newer Kafka APIs provide built-in support for this.

👉 **Guarantee:** Message is delivered **only once**.

🔹 Example:

* Kafka Streams processes messages in a transaction.
* Both results and offset commits are atomic → no duplicates, no loss.

---

## ✅ Summary

* **At-Most-Once** → Commit before processing → ⚡ Fast, ❌ risk of message loss
* **At-Least-Once** → Commit after processing → ✅ Reliable, 🔁 possible duplicates
* **Exactly-Once** → Use Kafka transactions → 🎯 Best, 🏆 no loss, no duplicates

---

👉 In real-world systems:

* **At-least-once** is most common (safe default).
* **Exactly-once** is used in financial/payment or critical systems 💰.
