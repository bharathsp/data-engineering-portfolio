# ğŸ“Œ Kafka Delivery Semantics (based on Offsets)

Kafkaâ€™s **offset management** directly impacts how messages are delivered and whether they can be reprocessed or lost.

There are **3 main delivery semantics**:

---

## 1ï¸âƒ£ **At-Most-Once (âš¡ Fast but Risky)**

* Offsets are **committed before processing** a message.
* If the consumer crashes after committing but before finishing processing â†’ that message is **lost**.

ğŸ‘‰ **Guarantee:** Message is delivered **0 or 1 time** (no duplicates, but possible loss).

ğŸ”¹ Example:

* Consumer commits offset=5 before actually processing message at offset=4.
* If crash happens â†’ message 4 is skipped. âŒ

---

## 2ï¸âƒ£ **At-Least-Once (âœ… Reliable, but may duplicate)**

* Offsets are **committed after processing** a message.
* If the consumer crashes before committing â†’ it will reprocess the same message after restart.
* So, messages are **never lost**, but may be **processed more than once**.

ğŸ‘‰ **Guarantee:** Message is delivered **1 or more times** (safe but may duplicate).

ğŸ”¹ Example:

* Consumer processes message at offset=4, but crashes before committing.
* On restart â†’ it will reprocess message 4 again â†’ duplicate âœ…

---

## 3ï¸âƒ£ **Exactly-Once (ğŸ† Ideal but Complex)**

* Ensures each message is processed **exactly once** â€” no loss, no duplication.
* Achieved by combining **idempotent producers** + **transactions** in Kafka + careful offset commits.
* Kafka Streams and newer Kafka APIs provide built-in support for this.

ğŸ‘‰ **Guarantee:** Message is delivered **only once**.

ğŸ”¹ Example:

* Kafka Streams processes messages in a transaction.
* Both results and offset commits are atomic â†’ no duplicates, no loss.

---

## âœ… Summary

* **At-Most-Once** â†’ Commit before processing â†’ âš¡ Fast, âŒ risk of message loss
* **At-Least-Once** â†’ Commit after processing â†’ âœ… Reliable, ğŸ” possible duplicates
* **Exactly-Once** â†’ Use Kafka transactions â†’ ğŸ¯ Best, ğŸ† no loss, no duplicates

---

ğŸ‘‰ In real-world systems:

* **At-least-once** is most common (safe default).
* **Exactly-once** is used in financial/payment or critical systems ğŸ’°.
