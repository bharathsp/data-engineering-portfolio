# 🔹 What is KRaft?

**KRaft** = **Kafka Raft (KRaft) consensus protocol**

👉 It is a **new way to manage Kafka metadata** that removes the dependency on **ZooKeeper**.
👉 Introduced in **Kafka 2.8.0** and becoming the **default architecture from Kafka 3.5+**.

---

# 🔹 Why was KRaft introduced?

Traditionally, Kafka relied on **ZooKeeper** for:

* Storing metadata (topics, partitions, offsets, ACLs, configs).
* Leader election of brokers and partitions.

But ZooKeeper added complexity:
❌ Extra service to maintain
❌ Hard to scale
❌ Operational overhead
❌ Slower metadata propagation

👉 **KRaft replaces ZooKeeper** by using an internal **Raft consensus algorithm** directly inside Kafka.

---

# 🔹 How KRaft Works

* Kafka introduces a new role: **Controller Quorum**.
* The **Controller Quorum** is a set of brokers running Raft consensus to manage metadata.
* Metadata = stored in a **metadata log** (just like Kafka topics).
* All brokers subscribe to this metadata log to stay in sync.

So instead of ZooKeeper, Kafka now uses:

* **Raft Leader** → handles writes to metadata log.
* **Raft Followers** → replicate metadata for fault tolerance.

---

# 🔹 Benefits of KRaft

✅ **No ZooKeeper** → Simpler architecture (only Kafka cluster to manage).
✅ **Better scalability** → Handle hundreds of thousands of partitions.
✅ **Faster metadata updates** → Changes propagate like Kafka messages.
✅ **Unified system** → One single distributed system (Kafka itself).
✅ **Stronger consistency** → Raft ensures strict consensus across controllers.

---

# 🔹 Kafka with KRaft Architecture

1. **Producers** → send messages to brokers.
2. **Brokers** → store messages in partitions.
3. **Controller Quorum (KRaft)** → manages cluster metadata (topics, partitions, leadership).
4. **Consumers** → read messages.

📌 Unlike ZooKeeper mode, all coordination is done internally via Raft.

---

# 🔹 Real-Life Analogy

Think of **ZooKeeper-based Kafka** like a company with:

* Kafka = Operations team
* ZooKeeper = Management team (separate office)

They always need to **communicate back and forth** → slower, more complex.

With **KRaft**, the **management team is merged into Kafka itself** → one unified office, decisions faster, less overhead.

---

# 🔹 Example (Simple Flow)

* You create a new topic `orders`.
* In ZooKeeper mode → Broker asks ZooKeeper → ZooKeeper updates metadata → Brokers sync.
* In KRaft mode → Broker sends request → **KRaft leader writes to metadata log** → all brokers replicate it → done instantly.

---

✅ **In summary:**
**KRaft = Kafka Raft metadata mode** → replaces ZooKeeper with Raft consensus.
It makes Kafka **simpler, faster, and more scalable**, and is the **future default for all Kafka clusters**.
